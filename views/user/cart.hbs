<!-- Shoping Cart -->

<div class="bg0 p-t-75 p-b-85">
    <div class="container">
        <div class="row">
            <div class="col-lg-10 col-xl-7 m-lr-auto m-b-50">
                <div class="m-l-25 m-r--38 m-lr-0-xl">
                    <div class="wrap-table-shopping-cart">
                        {{#if product}}
                        <table class="table-shopping-cart">
                            <tr class="table_head">
                                <th class="column-1">Product</th>
                                <th class="column-2"></th>
                                <th class="column-3">Price</th>
                                <th class="column-4">Quantity</th>
                                <th class="column-5">Total</th>
                                <th class="column-5">Remove</th>
                            </tr>

                            {{#each product}}
                            <tr class="table_row">
                                <td class="column-1">
                                    <div class="how-itemcart1">
                                        <img src="{{proDetails.[0].image.[0]}}" alt="IMG">
                                    </div>
                                </td>
                                <td class="column-2">{{this.proDetails.[0].name}}</td>
                                <td class="column-3" id="price{{this.proDetails.[0]._id}}">
                                    {{this.proDetails.[0].price}}
                                </td>
                                <td class="column-4">
                                    <button class="cart-item-count mr-3" style="background-color: #cd9b68 ;
                                        color:aliceblue; width: 3vh;" type="button"
                                        onclick="changeQuantity('{{this.proDetails.[0]._id}}',-1)">-</button>
                                    <span id="{{this.proDetails.[0]._id}}">{{this.products.quantity}}</span>
                                    <button class="cart-item-count ml-3"
                                        style="background-color: #cd9b68 ; color:aliceblue; width: 3vh;" type="button"
                                        onclick="changeQuantity('{{this.proDetails.[0]._id}}',1)">+</button>

                                </td>
                                <td class="column-5">
                                    <span id="{{this.proDetails.[0]._id}}total">{{mathMulti this.products.quantity
                                        this.proDetails.[0].price}}</span>
                                </td>
                                <td>
                                    <button type="button" onclick="removeProduct('{{this.proDetails.[0]._id}}')"
                                        class="btn btn-danger">Remove</button>
                                </td>
                            </tr>
                            <tr>
                                <div class="text-center text-success">
                                    <h4 id="delete-msg" class="font-italic"></h4>
                                </div>
                            </tr>
                            {{/each}}

                        </table>
                        {{/if}}
                    </div>

                    <div class="flex-w flex-sb-m bor15 p-t-18 p-b-15 p-lr-40 p-lr-15-sm">
                        <div class="flex-w flex-m m-r-20 m-tb-5">
                            <input class="stext-104 cl2 plh4 size-117 bor13 p-lr-20 m-r-10 m-tb-5" type="text"
                                name="coupon" placeholder="Coupon Code">

                            <div
                                class="flex-c-m stext-101 cl2 size-118 bg8 bor13 hov-btn3 p-lr-15 trans-04 pointer m-tb-5">
                                Apply coupon
                            </div>
                        </div>

                        <div
                            class="flex-c-m stext-101 cl2 size-119 bg8 bor13 hov-btn3 p-lr-15 trans-04 pointer m-tb-10">
                            Update Cart
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-sm-10 col-lg-7 col-xl-5 m-lr-auto m-b-50">
                <div class="bor10 p-lr-40 p-t-30 p-b-40 m-l-63 m-r-40 m-lr-0-xl p-lr-15-sm">
                    <h4 class="mtext-109 cl2 p-b-30">
                        Cart Totals
                    </h4>

                    <div class="flex-w flex-t p-t-27 p-b-33">
                        <div class="size-208">
                            <span class="mtext-101 cl2">
                                Total:
                            </span>
                        </div>

                        <div class="size-209 p-t-1">
                            <span class="mtext-110 cl2" data-price={{totalAmount}} id="totalValue">
                                Rs.{{totalAmount}}
                            </span>
                        </div>
                    </div>

                    <a href="/place-order" class=" flex-c-m stext-101 cl0 size-116 bg3 bor14 hov-btn3 p-lr-15 trans-04
                        pointer">Proceed to Checkout</a>

                    {{!-- <button
                        class=" flex-c-m stext-101 cl0 size-116 bg3 bor14 hov-btn3 p-lr-15 trans-04 pointer"><a
                            href="/place-order"></a>
                        Proceed to Checkout
                    </button> --}}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    window.onload = function () {
        //const subTotal = parseFloat(document.getElementById('subTotal').innerText);
        const subTotal1 = document.getElementById('totalValue');
        const subTotal = subTotal1.dataset.price;
        console.log(subTotal);
    }
</script>
<script>
    const subTotal1 = document.getElementById('totalValue');

    function removeProduct(proId, cartId) {
        var check = confirm("Do you want to remove from cart?")
        if (check) {
            $.ajax({
                url: `/remove-cart-product/${proId}`,
                method: 'GET',
                success: (response) => {
                    $(proId).remove()
                    let msg = name + " removed"
                    $('#delete-msg').html(msg)
                    location.reload();
                    console.log("removed");
                }
            })
        }
    }


    function changeQuantity(proId, count) {
        let quantity = parseInt(document.getElementById(proId).innerHTML)
        console.log(quantity)
        count = parseInt(count);
        $.ajax({
            url: '/change-product-quantity',
            data: {
                product: proId,
                count: count,
                quantity: quantity
            },
            method: 'post',
            success: (response) => {
                console.log("response :" + response);
                if (response.removeProduct) {
                    alert('Product removed from your cart');
                    location.reload()
                } else {
                    console.log(response.total);
                    document.getElementById(proId).innerHTML = quantity + count
                    document.getElementById(`${proId}total`).innerHTML = (quantity + count) *
                        document.getElementById(`price${proId}`).innerHTML;
                    document.getElementById('totalValue').innerHTML = response.total;
                }
            }
        })
    }
</script>